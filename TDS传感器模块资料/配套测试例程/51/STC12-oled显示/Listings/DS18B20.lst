C51 COMPILER V9.59.0.0   DS18B20                                                           06/13/2019 10:07:28 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE DS18B20
OBJECT MODULE PLACED IN .\Objects\DS18B20.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE User\DS18B20.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXT
                    -END PRINT(.\Listings\DS18B20.lst) TABS(2) OBJECT(.\Objects\DS18B20.obj)

line level    source

   1          #include "DS18B20.h"
   2          #include <intrins.h>
   3          
   4          /*
   5          **********************************************************************************************************
             -**********
   6          ÑÓÊ±Ê±¼ä      aµÄÖµ     bµÄÖµ       cµÄÖµ     ÑÓÊ±Îó²î£¨us£©
   7          10us          1           1           1            -0.5    
   8          20us          1           1           8            0  
   9          30us          1           1           15           +0.5 
  10          40us          2           1           9            0  
  11          50us          1           1           28            0  
  12          60us          1           1           35           +0.5 
  13          70us          1           1           42           +1 
  14          80us          1           1           48            0 
  15          90us          1           1           55           +0.5  
  16          100us         1           1           61           -0.5  
  17          200us         1           1           128           0  
  18          300us         3           1           63           +1.5  
  19          400us         2           1           129           0  
  20          500us         5           1           63           +0.5  
  21          600us         6           1           63            0  
  22          700us         7           1           63            -0.5  
  23          800us         1           3           175           +0.5  
  24          900us         9           1           63            -1.5  
  25          1ms           1           3           219           -1.5
  26          2ms           2           3           220           +3
  27          3ms           3           3           220           +3
  28          Xms           X           3           220           +3     
  29                 (XµÄ·¶Î§Îª2µ½255)
  30          */
  31          
  32          void Delay(unsigned char a1,b1,c1)
  33          {
  34   1       unsigned char a,b,c;
  35   1      for(a=0;a<a1;a++)
  36   1      for(b=0;b<b1;b++)
  37   1      for(c=0;c<c1;c++);
  38   1      }
  39          
  40          /*****************Init_Ds18b20******************/ 
  41          void Init_Ds18b20(void)     //DS18B20³õÊ¼»¯send reset and initialization command
  42          {
  43   1      DS18B20_DQ = 1;                     //DQ¸´Î»,²»ÒªÒ²¿ÉÐÐ¡£
  44   1      Delay(1,1,1);                  //ÉÔ×öÑÓÊ±  10us
  45   1      DS18B20_DQ = 0;                    //µ¥Æ¬»úÀ­µÍ×ÜÏß
  46   1      Delay(6,1,63); //600  us      //¾«È·ÑÓÊ±£¬Î¬³ÖÖÁÉÙ480us
  47   1      //Delay(1,1,15); //20us
  48   1      DS18B20_DQ = 1;                    //ÊÍ·Å×ÜÏß£¬¼´À­¸ßÁË×ÜÏß
  49   1      Delay(5,1,63); //500us               //´Ë´¦ÑÓÊ±ÓÐ×ã¹»,È·±£ÄÜÈÃDS18B20·¢³ö´æÔÚÂö³å¡£
  50   1      }
  51          
  52          unsigned char Read_One_Byte()       //¶ÁÈ¡Ò»¸ö×Ö½ÚµÄÊý¾Ýread a byte date
  53                                      //¶ÁÊý¾ÝÊ±,Êý¾ÝÒÔ×Ö½ÚµÄ×îµÍÓÐÐ§Î»ÏÈ´Ó×ÜÏßÒÆ³ö
C51 COMPILER V9.59.0.0   DS18B20                                                           06/13/2019 10:07:28 PAGE 2   

  54          {
  55   1      unsigned char i   = 0;
  56   1      unsigned char dat = 0;
  57   1      for(i=8;i>0;i--)
  58   1         {
  59   2         DS18B20_DQ = 0;                  //½«×ÜÏßÀ­µÍ£¬ÒªÔÚ1usÖ®ºóÊÍ·Å×ÜÏß
  60   2                                 //µ¥Æ¬»úÒªÔÚ´ËÏÂ½µÑØºóµÄ15usÄÚ¶ÁÊý¾Ý²Å»áÓÐÐ§¡£
  61   2         _nop_();                 //ÖÁÉÙÎ¬³ÖÁË1us,±íÊ¾¶ÁÊ±Ðò¿ªÊ¼
  62   2         dat >>= 1;               //ÈÃ´Ó×ÜÏßÉÏ¶Áµ½µÄÎ»Êý¾Ý£¬ÒÀ´Î´Ó¸ßÎ»ÒÆ¶¯µ½µÍÎ»¡£
  63   2         DS18B20_DQ = 1;                  //ÊÍ·Å×ÜÏß£¬´ËºóDS18B20»á¿ØÖÆ×ÜÏß,°ÑÊý¾Ý´«Êäµ½×ÜÏßÉÏ
  64   2         Delay(1,1,1);        //ÑÓÊ±10us,´Ë´¦²ÎÕÕÍÆ¼öµÄ¶ÁÊ±ÐòÍ¼£¬¾¡Á¿°Ñ¿ØÖÆÆ÷²ÉÑùÊ±¼ä·Åµ½¶ÁÊ±ÐòºóµÄ15usÄÚµÄ×îºó²
             -¿·Ö
  65   2         if(DS18B20_DQ)                   //¿ØÖÆÆ÷½øÐÐ²ÉÑù
  66   2         {
  67   3          dat |= 0x80;            //Èô×ÜÏßÎª1,¼´DQÎª1,ÄÇ¾Í°ÑdatµÄ×î¸ßÎ»ÖÃ1;ÈôÎª0,Ôò²»½øÐÐ´¦Àí,±£³ÖÎª0
  68   3         }        
  69   2         Delay(1,1,8);       //20us        //´ËÑÓÊ±²»ÄÜÉÙ£¬È·±£¶ÁÊ±ÐòµÄ³¤¶È60us¡£
  70   2      }
  71   1      return (dat);
  72   1      }
  73          
  74          void Write_One_Byte(unsigned char dat)
  75          {
  76   1      unsigned char i = 0;
  77   1      for(i=8;i>0;i--)
  78   1      {
  79   2         DS18B20_DQ = 0;                        //À­µÍ×ÜÏß
  80   2         _nop_();                       //ÖÁÉÙÎ¬³ÖÁË1us,±íÊ¾Ð´Ê±Ðò(°üÀ¨Ð´0Ê±Ðò»òÐ´1Ê±Ðò)¿ªÊ¼
  81   2         DS18B20_DQ = dat&0x01;                 //´Ó×Ö½ÚµÄ×îµÍÎ»¿ªÊ¼´«Êä
  82   2                                       //Ö¸ÁîdatµÄ×îµÍÎ»¸³Óè¸ø×ÜÏß,±ØÐëÔÚÀ­µÍ×ÜÏßºóµÄ15usÄÚ,
  83   2                                       //ÒòÎª15usºóDS18B20»á¶Ô×ÜÏß²ÉÑù¡£
  84   2         Delay(1,1,15);               //±ØÐëÈÃÐ´Ê±Ðò³ÖÐøÖÁÉÙ60us
  85   2         DS18B20_DQ = 1;                        //Ð´Íêºó,±ØÐëÊÍ·Å×ÜÏß,
  86   2         dat >>= 1;
  87   2         Delay(1,1,1);
  88   2      }
  89   1      }
  90          
  91          unsigned int Get_Temp()                   //»ñÈ¡ÎÂ¶Èget the wenduerature
  92          {
  93   1          float tt;
  94   1          unsigned char a,b;
  95   1          unsigned int temp;
  96   1          Init_Ds18b20();                //³õÊ¼»¯
  97   1          Write_One_Byte(0xcc);          //ºöÂÔROMÖ¸Áî
  98   1          Write_One_Byte(0x44);          //ÎÂ¶È×ª»»Ö¸Áî
  99   1          Init_Ds18b20();                 //³õÊ¼»¯
 100   1          Write_One_Byte(0xcc);          //ºöÂÔROMÖ¸Áî
 101   1          Write_One_Byte(0xbe);          //¶ÁÔÝ´æÆ÷Ö¸Áî
 102   1          a = Read_One_Byte();           //¶ÁÈ¡µ½µÄµÚÒ»¸ö×Ö½ÚÎªÎÂ¶ÈLSB
 103   1          b = Read_One_Byte();           //¶ÁÈ¡µ½µÄµÚÒ»¸ö×Ö½ÚÎªÎÂ¶ÈMSB
 104   1          temp = b;                      //ÏÈ°Ñ¸ß°ËÎ»ÓÐÐ§Êý¾Ý¸³ÓÚwendu
 105   1          temp <<= 8;                    //°ÑÒÔÉÏ8Î»Êý¾Ý´ÓwenduµÍ°ËÎ»ÒÆµ½¸ß°ËÎ»
 106   1          temp = temp|a;                //Á½×Ö½ÚºÏ³ÉÒ»¸öÕûÐÍ±äÁ¿
 107   1          tt = temp*0.0625;              //µÃµ½ÕæÊµÊ®½øÖÆÎÂ¶ÈÖµ
 108   1                                        //ÒòÎªDS18B20¿ÉÒÔ¾«È·µ½0.0625¶È
 109   1                                        //ËùÒÔ¶Á»ØÊý¾ÝµÄ×îµÍÎ»´ú±íµÄÊÇ0.0625¶È
 110   1          temp = tt*10+0.5;               //·Å´óÊ®±¶
 111   1                                        //ÕâÑù×öµÄÄ¿µÄ½«Ð¡ÊýµãºóµÚÒ»Î»Ò²×ª»»Îª¿ÉÏÔÊ¾Êý×Ö
 112   1                                        //Í¬Ê±½øÐÐÒ»¸öËÄÉáÎåÈë²Ù×÷¡£
 113   1          return temp;
 114   1      }
C51 COMPILER V9.59.0.0   DS18B20                                                           06/13/2019 10:07:28 PAGE 3   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    284    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      11
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
